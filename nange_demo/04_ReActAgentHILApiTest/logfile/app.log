2025-08-17 11:15:57,343 - __main__ - INFO - Redis初始化成功
2025-08-17 11:16:00,877 - utils.llms - INFO - 成功初始化 qwen LLM
2025-08-17 11:16:00,878 - __main__ - INFO - Chat模型初始化成功
2025-08-17 11:16:30,887 - __main__ - ERROR - 初始化失败: couldn't get a connection after 30.00 sec
2025-08-17 11:16:30,902 - __main__ - INFO - 关闭服务并完成资源清理
2025-08-17 11:17:08,042 - __main__ - INFO - Redis初始化成功
2025-08-17 11:17:11,686 - utils.llms - INFO - 成功初始化 qwen LLM
2025-08-17 11:17:11,687 - __main__ - INFO - Chat模型初始化成功
2025-08-17 11:17:11,840 - __main__ - INFO - Checkpointer初始化成功
2025-08-17 11:17:13,379 - __main__ - INFO - Agent初始化成功
2025-08-17 11:17:13,380 - __main__ - INFO - 服务完成初始化并启动服务
2025-08-17 11:39:31,816 - __main__ - INFO - 关闭服务并完成资源清理
2025-08-17 11:40:07,794 - __main__ - INFO - Redis初始化成功
2025-08-17 11:40:21,650 - utils.llms - INFO - 成功初始化 qwen LLM
2025-08-17 11:40:21,655 - __main__ - INFO - Chat模型初始化成功
2025-08-17 11:40:21,805 - __main__ - INFO - Checkpointer初始化成功
2025-08-17 11:40:24,805 - __main__ - INFO - Agent初始化成功
2025-08-17 11:40:24,811 - __main__ - INFO - 服务完成初始化并启动服务
2025-08-17 11:42:58,803 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:调用工具预定如家酒店
2025-08-17 11:42:58,828 - __main__ - ERROR - 用户 调用工具预定如家酒店 的会话不存在
2025-08-17 11:43:14,928 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='调用工具预定如家酒店' query='调用工具预定如家酒店' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-08-17 11:43:26,446 - __main__ - INFO - 当前触发工具调用中断:session_id='3480f1bf-de3d-44a8-9942-29042b278331' status='interrupted' timestamp=1755402206.4468045 message=None result=None interrupt_data={'action_request': {'action': 'book_hotel', 'args': {'hotel_name': '如家酒店'}}, 'config': None, 'description': "准备调用 book_hotel 工具：\n- 参数为: {'hotel_name': '如家酒店'}\n\n是否允许继续？\n输入 'yes' 接受工具调用\n输入 'no' 拒绝工具调用\n输入 'edit' 修改工具参数后调用工具\n输入 'response' 不调用工具直接反馈信息", 'interrupt_type': 'unknown'}
2025-08-17 11:44:34,470 - __main__ - INFO - resume_agent接口，接受到前端用户请求:user_id='调用工具预定如家酒店' session_id='3480f1bf-de3d-44a8-9942-29042b278331' response_type='accept' args=None
2025-08-17 11:44:34,549 - utils.tools - INFO - response: {'type': 'accept'}
2025-08-17 11:44:34,554 - utils.tools - INFO - 工具调用已批准，执行中...
2025-08-17 11:44:34,559 - utils.tools - INFO - 调用工具: book_hotel, 参数: {'hotel_name': '如家酒店'}
2025-08-17 11:44:34,575 - utils.tools - INFO - 成功预定了在如家酒店的住宿。
2025-08-17 11:44:36,298 - __main__ - INFO - 最终智能体回复结果:session_id='3480f1bf-de3d-44a8-9942-29042b278331' status='completed' timestamp=1755402276.2912343 message=None result={'messages': [SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='d057e60d-fd18-44cb-8192-70a640a1ef49'), HumanMessage(content='调用工具预定如家酒店', additional_kwargs={}, response_metadata={}, id='fb20848e-76c8-4c46-aaa3-00ba9f614469'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_2a8e62d7e6b94732907f79', 'function': {'arguments': '{"hotel_name": "如家酒店"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 23, 'prompt_tokens': 2293, 'total_tokens': 2316, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-plus', 'system_fingerprint': None, 'id': 'chatcmpl-ff07d973-daea-9c3c-aa22-ab2ca76e8c85', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--c7fa8d12-f9a7-447e-bef2-75bff99883a9-0', tool_calls=[{'name': 'book_hotel', 'args': {'hotel_name': '如家酒店'}, 'id': 'call_2a8e62d7e6b94732907f79', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2293, 'output_tokens': 23, 'total_tokens': 2316, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), ToolMessage(content='成功预定了在如家酒店的住宿。', name='book_hotel', id='766b110b-0217-4543-84aa-e38fa1a9855b', tool_call_id='call_2a8e62d7e6b94732907f79'), AIMessage(content='您已成功预定如家酒店的住宿。如有其他需求或问题，请随时告知！', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 19, 'prompt_tokens': 2355, 'total_tokens': 2374, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-plus', 'system_fingerprint': None, 'id': 'chatcmpl-11b29d46-e60c-90d2-b5b2-c55b4e8fd027', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--546b1ce1-5f0f-41ec-8b3d-15ef8a1e17e1-0', usage_metadata={'input_tokens': 2355, 'output_tokens': 19, 'total_tokens': 2374, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}})]} interrupt_data=None
2025-08-17 11:44:38,484 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:调用工具预定如家酒店
2025-08-17 11:44:38,496 - __main__ - INFO - 返回当前用户的状态:user_id='调用工具预定如家酒店' session_id='3480f1bf-de3d-44a8-9942-29042b278331' status='completed' message=None last_query='调用工具预定如家酒店' last_updated=1755402276.3062203 last_response=AgentResponse(session_id='3480f1bf-de3d-44a8-9942-29042b278331', status='completed', timestamp=1755402276.2912343, message=None, result={'messages': [{'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'd057e60d-fd18-44cb-8192-70a640a1ef49'}, {'content': '调用工具预定如家酒店', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': 'fb20848e-76c8-4c46-aaa3-00ba9f614469', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_2a8e62d7e6b94732907f79', 'function': {'arguments': '{"hotel_name": "如家酒店"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 23, 'prompt_tokens': 2293, 'total_tokens': 2316, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-plus', 'system_fingerprint': None, 'id': 'chatcmpl-ff07d973-daea-9c3c-aa22-ab2ca76e8c85', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--c7fa8d12-f9a7-447e-bef2-75bff99883a9-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '如家酒店'}, 'id': 'call_2a8e62d7e6b94732907f79', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2293, 'output_tokens': 23, 'total_tokens': 2316, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '成功预定了在如家酒店的住宿。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': '766b110b-0217-4543-84aa-e38fa1a9855b', 'tool_call_id': 'call_2a8e62d7e6b94732907f79', 'artifact': None, 'status': 'success'}, {'content': '您已成功预定如家酒店的住宿。如有其他需求或问题，请随时告知！', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 19, 'prompt_tokens': 2355, 'total_tokens': 2374, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-plus', 'system_fingerprint': None, 'id': 'chatcmpl-11b29d46-e60c-90d2-b5b2-c55b4e8fd027', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--546b1ce1-5f0f-41ec-8b3d-15ef8a1e17e1-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2355, 'output_tokens': 19, 'total_tokens': 2374, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}]}, interrupt_data=None)
2025-08-17 11:45:02,156 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='调用工具预定如家酒店' query='调用工具预定如家酒店' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-08-17 11:47:17,433 - __main__ - INFO - 当前触发工具调用中断:session_id='3480f1bf-de3d-44a8-9942-29042b278331' status='interrupted' timestamp=1755402437.433259 message=None result=None interrupt_data={'action_request': {'action': 'book_hotel', 'args': {'hotel_name': '如家酒店'}}, 'config': None, 'description': "准备调用 book_hotel 工具：\n- 参数为: {'hotel_name': '如家酒店'}\n\n是否允许继续？\n输入 'yes' 接受工具调用\n输入 'no' 拒绝工具调用\n输入 'edit' 修改工具参数后调用工具\n输入 'response' 不调用工具直接反馈信息", 'interrupt_type': 'unknown'}
2025-08-17 11:54:31,771 - __main__ - INFO - resume_agent接口，接受到前端用户请求:user_id='调用工具预定如家酒店' session_id='3480f1bf-de3d-44a8-9942-29042b278331' response_type='reject' args=None
2025-08-17 11:54:31,820 - utils.tools - INFO - response: {'type': 'reject'}
2025-08-17 11:54:31,822 - utils.tools - INFO - 工具调用被拒绝，等待用户输入...
2025-08-17 11:54:33,835 - __main__ - INFO - 最终智能体回复结果:session_id='3480f1bf-de3d-44a8-9942-29042b278331' status='completed' timestamp=1755402873.8279667 message=None result={'messages': [SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='d057e60d-fd18-44cb-8192-70a640a1ef49'), HumanMessage(content='调用工具预定如家酒店', additional_kwargs={}, response_metadata={}, id='fb20848e-76c8-4c46-aaa3-00ba9f614469'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_2a8e62d7e6b94732907f79', 'function': {'arguments': '{"hotel_name": "如家酒店"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 23, 'prompt_tokens': 2293, 'total_tokens': 2316, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-plus', 'system_fingerprint': None, 'id': 'chatcmpl-ff07d973-daea-9c3c-aa22-ab2ca76e8c85', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--c7fa8d12-f9a7-447e-bef2-75bff99883a9-0', tool_calls=[{'name': 'book_hotel', 'args': {'hotel_name': '如家酒店'}, 'id': 'call_2a8e62d7e6b94732907f79', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2293, 'output_tokens': 23, 'total_tokens': 2316, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), ToolMessage(content='成功预定了在如家酒店的住宿。', name='book_hotel', id='766b110b-0217-4543-84aa-e38fa1a9855b', tool_call_id='call_2a8e62d7e6b94732907f79'), AIMessage(content='您已成功预定如家酒店的住宿。如有其他需求或问题，请随时告知！', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 19, 'prompt_tokens': 2355, 'total_tokens': 2374, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-plus', 'system_fingerprint': None, 'id': 'chatcmpl-11b29d46-e60c-90d2-b5b2-c55b4e8fd027', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--546b1ce1-5f0f-41ec-8b3d-15ef8a1e17e1-0', usage_metadata={'input_tokens': 2355, 'output_tokens': 19, 'total_tokens': 2374, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='985c5b38-62d5-4759-a6bb-d38e2b79271f'), HumanMessage(content='调用工具预定如家酒店', additional_kwargs={}, response_metadata={}, id='c6753aa4-7a1a-4d39-a19a-b07188cb4bac'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_ab4fa6eec045487a87c88e', 'function': {'arguments': '{"hotel_name": "如家酒店"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 23, 'prompt_tokens': 2407, 'total_tokens': 2430, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-plus', 'system_fingerprint': None, 'id': 'chatcmpl-04272a15-5ce0-9c24-a567-ea40f63f6320', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--c35a3d33-8351-43c6-832c-59d1e022e8d8-0', tool_calls=[{'name': 'book_hotel', 'args': {'hotel_name': '如家酒店'}, 'id': 'call_ab4fa6eec045487a87c88e', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2407, 'output_tokens': 23, 'total_tokens': 2430, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), ToolMessage(content='该工具被拒绝使用，请尝试其他方法或拒绝回答问题。', name='book_hotel', id='c0050e63-adf8-4732-ba35-418aff01065f', tool_call_id='call_ab4fa6eec045487a87c88e'), AIMessage(content='非常抱歉，目前无法使用工具预定如家酒店。您可以尝试通过其他方式进行预订，例如访问酒店官网或使用相关的预订平台。如果有其他问题需要帮助，请随时告诉我！', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 2473, 'total_tokens': 2511, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-plus', 'system_fingerprint': None, 'id': 'chatcmpl-356a8da3-b8e5-9df1-848f-2f2ff7d22a4c', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--ad27d75e-c923-4cb5-8e93-e7dd6dbe4c85-0', usage_metadata={'input_tokens': 2473, 'output_tokens': 38, 'total_tokens': 2511, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}})]} interrupt_data=None
2025-08-17 11:54:36,070 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:调用工具预定如家酒店
2025-08-17 11:54:36,079 - __main__ - INFO - 返回当前用户的状态:user_id='调用工具预定如家酒店' session_id='3480f1bf-de3d-44a8-9942-29042b278331' status='completed' message=None last_query='调用工具预定如家酒店' last_updated=1755402873.840679 last_response=AgentResponse(session_id='3480f1bf-de3d-44a8-9942-29042b278331', status='completed', timestamp=1755402873.8279667, message=None, result={'messages': [{'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'd057e60d-fd18-44cb-8192-70a640a1ef49'}, {'content': '调用工具预定如家酒店', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': 'fb20848e-76c8-4c46-aaa3-00ba9f614469', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_2a8e62d7e6b94732907f79', 'function': {'arguments': '{"hotel_name": "如家酒店"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 23, 'prompt_tokens': 2293, 'total_tokens': 2316, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-plus', 'system_fingerprint': None, 'id': 'chatcmpl-ff07d973-daea-9c3c-aa22-ab2ca76e8c85', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--c7fa8d12-f9a7-447e-bef2-75bff99883a9-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '如家酒店'}, 'id': 'call_2a8e62d7e6b94732907f79', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2293, 'output_tokens': 23, 'total_tokens': 2316, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '成功预定了在如家酒店的住宿。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': '766b110b-0217-4543-84aa-e38fa1a9855b', 'tool_call_id': 'call_2a8e62d7e6b94732907f79', 'artifact': None, 'status': 'success'}, {'content': '您已成功预定如家酒店的住宿。如有其他需求或问题，请随时告知！', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 19, 'prompt_tokens': 2355, 'total_tokens': 2374, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-plus', 'system_fingerprint': None, 'id': 'chatcmpl-11b29d46-e60c-90d2-b5b2-c55b4e8fd027', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--546b1ce1-5f0f-41ec-8b3d-15ef8a1e17e1-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2355, 'output_tokens': 19, 'total_tokens': 2374, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': '985c5b38-62d5-4759-a6bb-d38e2b79271f'}, {'content': '调用工具预定如家酒店', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': 'c6753aa4-7a1a-4d39-a19a-b07188cb4bac', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_ab4fa6eec045487a87c88e', 'function': {'arguments': '{"hotel_name": "如家酒店"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 23, 'prompt_tokens': 2407, 'total_tokens': 2430, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-plus', 'system_fingerprint': None, 'id': 'chatcmpl-04272a15-5ce0-9c24-a567-ea40f63f6320', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--c35a3d33-8351-43c6-832c-59d1e022e8d8-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '如家酒店'}, 'id': 'call_ab4fa6eec045487a87c88e', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2407, 'output_tokens': 23, 'total_tokens': 2430, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '该工具被拒绝使用，请尝试其他方法或拒绝回答问题。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': 'c0050e63-adf8-4732-ba35-418aff01065f', 'tool_call_id': 'call_ab4fa6eec045487a87c88e', 'artifact': None, 'status': 'success'}, {'content': '非常抱歉，目前无法使用工具预定如家酒店。您可以尝试通过其他方式进行预订，例如访问酒店官网或使用相关的预订平台。如果有其他问题需要帮助，请随时告诉我！', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 38, 'prompt_tokens': 2473, 'total_tokens': 2511, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-plus', 'system_fingerprint': None, 'id': 'chatcmpl-356a8da3-b8e5-9df1-848f-2f2ff7d22a4c', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--ad27d75e-c923-4cb5-8e93-e7dd6dbe4c85-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2473, 'output_tokens': 38, 'total_tokens': 2511, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}]}, interrupt_data=None)
2025-08-17 11:55:23,729 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='调用工具预定如家酒店' query='调用工具预定如家酒店' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-08-17 12:01:08,355 - __main__ - INFO - 当前触发工具调用中断:session_id='3480f1bf-de3d-44a8-9942-29042b278331' status='interrupted' timestamp=1755403268.3554223 message=None result=None interrupt_data={'action_request': {'action': 'book_hotel', 'args': {'hotel_name': '如家酒店'}}, 'config': None, 'description': "准备调用 book_hotel 工具：\n- 参数为: {'hotel_name': '如家酒店'}\n\n是否允许继续？\n输入 'yes' 接受工具调用\n输入 'no' 拒绝工具调用\n输入 'edit' 修改工具参数后调用工具\n输入 'response' 不调用工具直接反馈信息", 'interrupt_type': 'unknown'}
2025-08-17 12:01:16,100 - __main__ - INFO - 关闭服务并完成资源清理
2025-08-17 19:59:23,298 - __main__ - INFO - Redis初始化成功
2025-08-17 19:59:30,406 - utils.llms - INFO - 成功初始化 qwen LLM
2025-08-17 19:59:30,407 - __main__ - INFO - Chat模型初始化成功
2025-08-17 19:59:30,504 - __main__ - INFO - Checkpointer初始化成功
2025-08-17 19:59:32,389 - __main__ - INFO - Agent初始化成功
2025-08-17 19:59:32,390 - __main__ - INFO - 服务完成初始化并启动服务
2025-08-17 20:01:51,398 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:深圳天气怎么样
2025-08-17 20:01:51,415 - __main__ - ERROR - 用户 深圳天气怎么样 的会话不存在
2025-08-17 20:02:11,379 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:深圳天气怎么样
2025-08-17 20:02:11,382 - __main__ - ERROR - 用户 深圳天气怎么样 的会话不存在
2025-08-17 20:02:28,370 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='深圳天气怎么样' query='深圳天气怎么样' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-08-17 20:02:29,726 - __main__ - INFO - 当前触发工具调用中断:session_id='c77a5ec4-521f-49b3-951e-b9f086e48bed' status='interrupted' timestamp=1755432149.7266624 message=None result=None interrupt_data={'action_request': {'action': 'maps_weather', 'args': {'city': '深圳'}}, 'config': None, 'description': "准备调用 maps_weather 工具：\n- 参数为: {'city': '深圳'}\n\n是否允许继续？\n输入 'yes' 接受工具调用\n输入 'no' 拒绝工具调用\n输入 'edit' 修改工具参数后调用工具\n输入 'response' 不调用工具直接反馈信息", 'interrupt_type': 'unknown'}
2025-08-17 20:02:48,193 - __main__ - INFO - resume_agent接口，接受到前端用户请求:user_id='深圳天气怎么样' session_id='c77a5ec4-521f-49b3-951e-b9f086e48bed' response_type='accept' args=None
2025-08-17 20:02:48,218 - utils.tools - INFO - response: {'type': 'accept'}
2025-08-17 20:02:48,219 - utils.tools - INFO - 工具调用已批准，执行中...
2025-08-17 20:02:48,220 - utils.tools - INFO - 调用工具: maps_weather, 参数: {'city': '深圳'}
2025-08-17 20:02:49,937 - utils.tools - INFO - {"city":"深圳市","forecasts":[{"date":"2025-08-17","week":"7","dayweather":"雷阵雨","nightweather":"中雨-大雨","daytemp":"30","nighttemp":"24","daywind":"东","nightwind":"东","daypower":"1-3","nightpower":"1-3","daytemp_float":"30.0","nighttemp_float":"24.0"},{"date":"2025-08-18","week":"1","dayweather":"大雨-暴雨","nightweather":"雷阵雨","daytemp":"29","nighttemp":"25","daywind":"东","nightwind":"东","daypower":"1-3","nightpower":"1-3","daytemp_float":"29.0","nighttemp_float":"25.0"},{"date":"2025-08-19","week":"2","dayweather":"雷阵雨","nightweather":"阵雨","daytemp":"30","nighttemp":"25","daywind":"北","nightwind":"北","daypower":"1-3","nightpower":"1-3","daytemp_float":"30.0","nighttemp_float":"25.0"},{"date":"2025-08-20","week":"3","dayweather":"阵雨","nightweather":"多云","daytemp":"31","nighttemp":"26","daywind":"北","nightwind":"北","daypower":"1-3","nightpower":"1-3","daytemp_float":"31.0","nighttemp_float":"26.0"}]}
2025-08-17 20:02:56,862 - __main__ - INFO - 最终智能体回复结果:session_id='c77a5ec4-521f-49b3-951e-b9f086e48bed' status='completed' timestamp=1755432176.8615217 message=None result={'messages': [SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='ab246fc8-de7f-48ee-9c45-048e5471741a'), HumanMessage(content='深圳天气怎么样', additional_kwargs={}, response_metadata={}, id='d5eb07c7-d38c-4997-864d-6a8dcec740fd'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_5ad750f65f4b40c9b687b8', 'function': {'arguments': '{"city": "深圳"}', 'name': 'maps_weather'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 19, 'prompt_tokens': 2289, 'total_tokens': 2308, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-plus', 'system_fingerprint': None, 'id': 'chatcmpl-1a05c68e-c16f-96b1-a14a-7d2d36c03802', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--20e1cdbe-53bb-4478-9dc4-369d019c1c58-0', tool_calls=[{'name': 'maps_weather', 'args': {'city': '深圳'}, 'id': 'call_5ad750f65f4b40c9b687b8', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2289, 'output_tokens': 19, 'total_tokens': 2308, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), ToolMessage(content='{"city":"深圳市","forecasts":[{"date":"2025-08-17","week":"7","dayweather":"雷阵雨","nightweather":"中雨-大雨","daytemp":"30","nighttemp":"24","daywind":"东","nightwind":"东","daypower":"1-3","nightpower":"1-3","daytemp_float":"30.0","nighttemp_float":"24.0"},{"date":"2025-08-18","week":"1","dayweather":"大雨-暴雨","nightweather":"雷阵雨","daytemp":"29","nighttemp":"25","daywind":"东","nightwind":"东","daypower":"1-3","nightpower":"1-3","daytemp_float":"29.0","nighttemp_float":"25.0"},{"date":"2025-08-19","week":"2","dayweather":"雷阵雨","nightweather":"阵雨","daytemp":"30","nighttemp":"25","daywind":"北","nightwind":"北","daypower":"1-3","nightpower":"1-3","daytemp_float":"30.0","nighttemp_float":"25.0"},{"date":"2025-08-20","week":"3","dayweather":"阵雨","nightweather":"多云","daytemp":"31","nighttemp":"26","daywind":"北","nightwind":"北","daypower":"1-3","nightpower":"1-3","daytemp_float":"31.0","nighttemp_float":"26.0"}]}', name='maps_weather', id='73604311-239c-49ec-8c3f-7130244fe291', tool_call_id='call_5ad750f65f4b40c9b687b8'), AIMessage(content='以下是深圳市的天气预报：\n\n- **2025年08月17日（星期日）**\n  - 白天：雷阵雨，温度 30°C，东风 1-3 级\n  - 夜间：中雨-大雨，温度 24°C，东风 1-3 级\n\n- **2025年08月18日（星期一）**\n  - 白天：大雨-暴雨，温度 29°C，东风 1-3 级\n  - 夜间：雷阵雨，温度 25°C，东风 1-3 级\n\n- **2025年08月19日（星期二）**\n  - 白天：雷阵雨，温度 30°C，北风 1-3 级\n  - 夜间：阵雨，温度 25°C，北风 1-3 级\n\n- **2025年08月20日（星期三）**\n  - 白天：阵雨，温度 31°C，北风 1-3 级\n  - 夜间：多云，温度 26°C，北风 1-3 级\n\n希望这些信息对你有帮助！', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 287, 'prompt_tokens': 2676, 'total_tokens': 2963, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-plus', 'system_fingerprint': None, 'id': 'chatcmpl-6edfc2f3-af94-9b52-8bad-7b668fbce4f7', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--13b2f469-bea4-4e59-ba75-9dbe37693503-0', usage_metadata={'input_tokens': 2676, 'output_tokens': 287, 'total_tokens': 2963, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}})]} interrupt_data=None
2025-08-17 20:02:58,935 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:深圳天气怎么样
2025-08-17 20:02:58,939 - __main__ - INFO - 返回当前用户的状态:user_id='深圳天气怎么样' session_id='c77a5ec4-521f-49b3-951e-b9f086e48bed' status='completed' message=None last_query='深圳天气怎么样' last_updated=1755432176.864821 last_response=AgentResponse(session_id='c77a5ec4-521f-49b3-951e-b9f086e48bed', status='completed', timestamp=1755432176.8615217, message=None, result={'messages': [{'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'ab246fc8-de7f-48ee-9c45-048e5471741a'}, {'content': '深圳天气怎么样', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': 'd5eb07c7-d38c-4997-864d-6a8dcec740fd', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_5ad750f65f4b40c9b687b8', 'function': {'arguments': '{"city": "深圳"}', 'name': 'maps_weather'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 19, 'prompt_tokens': 2289, 'total_tokens': 2308, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-plus', 'system_fingerprint': None, 'id': 'chatcmpl-1a05c68e-c16f-96b1-a14a-7d2d36c03802', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--20e1cdbe-53bb-4478-9dc4-369d019c1c58-0', 'example': False, 'tool_calls': [{'name': 'maps_weather', 'args': {'city': '深圳'}, 'id': 'call_5ad750f65f4b40c9b687b8', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2289, 'output_tokens': 19, 'total_tokens': 2308, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '{"city":"深圳市","forecasts":[{"date":"2025-08-17","week":"7","dayweather":"雷阵雨","nightweather":"中雨-大雨","daytemp":"30","nighttemp":"24","daywind":"东","nightwind":"东","daypower":"1-3","nightpower":"1-3","daytemp_float":"30.0","nighttemp_float":"24.0"},{"date":"2025-08-18","week":"1","dayweather":"大雨-暴雨","nightweather":"雷阵雨","daytemp":"29","nighttemp":"25","daywind":"东","nightwind":"东","daypower":"1-3","nightpower":"1-3","daytemp_float":"29.0","nighttemp_float":"25.0"},{"date":"2025-08-19","week":"2","dayweather":"雷阵雨","nightweather":"阵雨","daytemp":"30","nighttemp":"25","daywind":"北","nightwind":"北","daypower":"1-3","nightpower":"1-3","daytemp_float":"30.0","nighttemp_float":"25.0"},{"date":"2025-08-20","week":"3","dayweather":"阵雨","nightweather":"多云","daytemp":"31","nighttemp":"26","daywind":"北","nightwind":"北","daypower":"1-3","nightpower":"1-3","daytemp_float":"31.0","nighttemp_float":"26.0"}]}', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'maps_weather', 'id': '73604311-239c-49ec-8c3f-7130244fe291', 'tool_call_id': 'call_5ad750f65f4b40c9b687b8', 'artifact': None, 'status': 'success'}, {'content': '以下是深圳市的天气预报：\n\n- **2025年08月17日（星期日）**\n  - 白天：雷阵雨，温度 30°C，东风 1-3 级\n  - 夜间：中雨-大雨，温度 24°C，东风 1-3 级\n\n- **2025年08月18日（星期一）**\n  - 白天：大雨-暴雨，温度 29°C，东风 1-3 级\n  - 夜间：雷阵雨，温度 25°C，东风 1-3 级\n\n- **2025年08月19日（星期二）**\n  - 白天：雷阵雨，温度 30°C，北风 1-3 级\n  - 夜间：阵雨，温度 25°C，北风 1-3 级\n\n- **2025年08月20日（星期三）**\n  - 白天：阵雨，温度 31°C，北风 1-3 级\n  - 夜间：多云，温度 26°C，北风 1-3 级\n\n希望这些信息对你有帮助！', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 287, 'prompt_tokens': 2676, 'total_tokens': 2963, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-plus', 'system_fingerprint': None, 'id': 'chatcmpl-6edfc2f3-af94-9b52-8bad-7b668fbce4f7', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--13b2f469-bea4-4e59-ba75-9dbe37693503-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2676, 'output_tokens': 287, 'total_tokens': 2963, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}]}, interrupt_data=None)
